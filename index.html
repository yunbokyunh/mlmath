<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ML MATH â€” ë¬´ë£Œ ìˆ˜í•™ ë ˆë²¨í…ŒìŠ¤íŠ¸</title>
    <meta name="description" content="IGCSE & Add Math ì „ë¬¸ ë ˆë²¨í…ŒìŠ¤íŠ¸. ê³µëŒ€ ì„ì‚¬ ì¶œì‹  ì„ ìƒë‹˜ì˜ ì •ë°€ ì§„ë‹¨ìœ¼ë¡œ ìš°ë¦¬ ì•„ì´ ìˆ˜í•™ ì‹¤ë ¥ì„ ì •í™•íˆ íŒŒì•…í•˜ì„¸ìš”.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EZTWKH051F"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-EZTWKH051F');</script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--s9:#0f172a;--s8:#1e293b;--s7:#334155;--s6:#475569;--s5:#64748b;--s4:#94a3b8;--s3:#cbd5e1;--s2:#e2e8f0;--s1:#f1f5f9;--s0:#f8fafc;--b7:#1d4ed8;--b6:#2563eb;--b5:#3b82f6;--b1:#dbeafe;--b0:#eff6ff;--a6:#d97706;--a1:#fef3c7;--a0:#fffbeb;--e6:#059669;--e1:#d1fae5;--e0:#ecfdf5;--v6:#7c3aed;--v1:#ede9fe;--v0:#f5f3ff;--r6:#e11d48;--r1:#ffe4e6;--w:#fff}
        html,body{height:100%;overflow:hidden}
        body{font-family:'Noto Sans KR','DM Sans',sans-serif;background:#e8ecf4;display:flex;flex-direction:column}

        /* Top bar */
        .top-bar{background:var(--s9);padding:14px 24px;display:flex;justify-content:space-between;align-items:center;flex-shrink:0;z-index:10}
        .logo{font-family:'DM Sans',sans-serif;font-weight:700;font-size:18px;color:var(--w);letter-spacing:2px}.logo span{color:var(--b5)}
        .top-badge{font-size:10px;color:var(--s3);letter-spacing:1.5px;text-transform:uppercase;background:rgba(255,255,255,.08);padding:4px 12px;border-radius:16px}

        /* Progress */
        .progress-track{height:3px;background:var(--s8);flex-shrink:0}
        .progress-fill{height:100%;background:linear-gradient(90deg,var(--b6),var(--b5),#818cf8);transition:width .5s cubic-bezier(.4,0,.2,1)}

        /* Scroll */
        .scroll-area{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch}
        .scroll-inner{max-width:740px;margin:0 auto;padding:20px 16px 100px}

        /* Navigation */
        .fixed-nav{position:fixed;bottom:0;left:0;right:0;background:var(--w);border-top:1px solid var(--s2);padding:14px 20px;display:none;justify-content:space-between;align-items:center;z-index:20;box-shadow:0 -4px 20px rgba(0,0,0,.06)}
        .fixed-nav.show{display:flex}
        .btn{padding:11px 22px;font-family:'Noto Sans KR',sans-serif;font-size:14px;font-weight:500;border:none;border-radius:10px;cursor:pointer;transition:all .15s;-webkit-tap-highlight-color:transparent}
        .btn:active:not(:disabled){transform:scale(.97)}
        .btn-prev{background:var(--s1);color:var(--s6)}.btn-prev:hover:not(:disabled){background:var(--s2)}
        .btn-next{background:var(--s9);color:var(--w)}.btn-next:hover{background:var(--s8)}
        .btn:disabled{opacity:.3;cursor:not-allowed}
        .page-indicator{font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--s4)}

        /* Cards */
        .card{background:var(--w);border-radius:16px;box-shadow:0 2px 8px rgba(0,0,0,.06);overflow:hidden;margin-bottom:16px}
        .screen{display:none}.screen.active{display:block}

        /* ===== LANDING PAGE ===== */
        .hero{padding:32px 24px 24px;text-align:center}
        .hero-badge{display:inline-block;font-family:'DM Sans',sans-serif;font-size:11px;font-weight:600;color:var(--b6);background:var(--b0);padding:5px 14px;border-radius:20px;margin-bottom:14px;letter-spacing:.5px}
        .hero h1{font-size:22px;font-weight:700;color:var(--s9);line-height:1.5;margin-bottom:6px}
        .hero h1 em{font-style:normal;color:var(--b6)}
        .hero-sub{font-size:13px;color:var(--s5);line-height:1.7;margin-bottom:20px}
        .hero-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:20px}
        .hero-stat{background:var(--s0);border-radius:10px;padding:14px 8px;text-align:center}
        .hero-stat .n{font-family:'JetBrains Mono',monospace;font-size:18px;font-weight:700;color:var(--s9)}
        .hero-stat .l{font-size:10px;color:var(--s5);margin-top:2px}
        .usp-list{text-align:left;margin-bottom:20px}
        .usp{display:flex;gap:10px;align-items:flex-start;padding:10px 16px;background:var(--s0);border-radius:10px;margin-bottom:6px}
        .usp .ic{font-size:18px;flex-shrink:0;margin-top:1px}
        .usp .tx{font-size:13px;color:var(--s7);line-height:1.6}
        .usp .tx b{color:var(--s9)}

        /* ===== REGISTRATION FORM ===== */
        .reg-pad{padding:24px}
        .reg-pad h2{font-size:17px;color:var(--s9);margin-bottom:4px}
        .reg-sub{font-size:12px;color:var(--s5);margin-bottom:16px}
        .form-group{margin-bottom:12px}
        .form-label{font-size:11px;font-weight:600;color:var(--s6);margin-bottom:4px;display:flex;align-items:center;gap:4px}
        .form-label .req{color:var(--r6);font-size:10px}
        .form-input{width:100%;border:1.5px solid var(--s2);border-radius:10px;padding:12px 14px;font-family:'Noto Sans KR',sans-serif;font-size:14px;color:var(--s8);outline:none;transition:border .2s}
        .form-input:focus{border-color:var(--b5);box-shadow:0 0 0 3px rgba(59,130,246,.08)}
        .form-input::placeholder{color:var(--s4);font-size:13px}
        select.form-input{-webkit-appearance:none;appearance:none;background:var(--w) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E") no-repeat right 14px center}
        .form-hint{font-size:11px;color:var(--s4);margin-top:3px}
        .form-error{font-size:11px;color:var(--r6);margin-top:3px;display:none}
        .addm-toggle{display:flex;gap:6px;margin-bottom:8px}
        .addm-btn{flex:1;padding:12px 8px;font-family:'Noto Sans KR',sans-serif;font-size:13px;font-weight:500;border:1.5px solid var(--s2);border-radius:10px;background:var(--w);color:var(--s6);cursor:pointer;transition:all .2s;-webkit-tap-highlight-color:transparent}
        .addm-btn:active{transform:scale(.98)}
        .addm-btn.active{border-color:var(--b6);background:var(--b0);color:var(--b7);font-weight:600;box-shadow:0 0 0 3px rgba(59,130,246,.1)}
        .addm-info{font-size:12px;color:var(--s5);padding:10px 14px;background:var(--s0);border-radius:8px;display:flex;align-items:center;gap:8px;transition:all .3s}
        .addm-tag{font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:600;padding:3px 8px;border-radius:5px;white-space:nowrap}
        .addm-tag.igcse{background:var(--b1);color:var(--b7)}
        .addm-tag.full{background:var(--v1);color:var(--v6)}

        .warn-box{background:var(--a0);border:1px solid var(--a1);border-radius:10px;padding:12px 14px;margin-bottom:16px;display:flex;gap:8px;align-items:flex-start}
        .warn-box .ic{font-size:16px;flex-shrink:0}.warn-box p{font-size:12px;color:var(--s7);line-height:1.6}
        .privacy-note{font-size:11px;color:var(--s5);text-align:center;margin-top:14px;line-height:1.6;background:var(--s0);padding:12px 16px;border-radius:10px;border:1px solid var(--s2)}

        /* ===== BUTTONS ===== */
        .btn-big{width:100%;padding:15px;font-family:'Noto Sans KR',sans-serif;font-size:15px;font-weight:600;border:none;border-radius:12px;cursor:pointer;transition:all .15s;-webkit-tap-highlight-color:transparent}
        .btn-big:active{transform:scale(.98)}
        .btn-big.primary{background:var(--s9);color:var(--w)}.btn-big.primary:hover{background:var(--s8)}
        .btn-big.blue{background:var(--b6);color:var(--w)}.btn-big.blue:hover{background:var(--b7)}
        .btn-big.secondary{background:var(--s1);color:var(--s7);margin-top:8px;font-size:13px;font-weight:500}.btn-big.secondary:hover{background:var(--s2)}
        .btn-big:disabled{opacity:.5;cursor:not-allowed}
        .file-hidden{display:none}

        /* ===== QUESTION SCREENS ===== */
        .part-strip{display:flex;align-items:center;gap:12px;padding:16px 20px;border-bottom:1px solid var(--s1)}
        .part-badge{font-family:'JetBrains Mono','DM Sans',sans-serif;font-size:11px;font-weight:500;padding:4px 10px;border-radius:5px;white-space:nowrap}
        .part-a .part-badge{background:var(--b1);color:var(--b7)}
        .part-b .part-badge{background:var(--a1);color:var(--a6)}
        .part-c .part-badge{background:var(--v1);color:var(--v6)}
        .part-d .part-badge{background:var(--e1);color:var(--e6)}
        .part-e .part-badge{background:var(--r1);color:var(--r6)}
        .part-info{flex:1}.part-title{font-size:13px;font-weight:600;color:var(--s8)}.part-focus{font-size:11px;color:var(--s5);margin-top:1px}
        .part-time{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--s4);background:var(--s0);padding:3px 8px;border-radius:5px}
        .q-pad{padding:22px 20px}
        .q-label{display:flex;align-items:center;gap:10px;margin-bottom:16px}
        .q-num{font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:500;color:var(--b6);background:var(--b0);padding:4px 10px;border-radius:6px}
        .q-cat{font-size:12px;color:var(--s5);font-weight:500}
        .q-dot{width:7px;height:7px;border-radius:50%;background:var(--e6);margin-left:auto;display:none}.q-dot.on{display:block}
        .q-body{font-family:'DM Sans',sans-serif;font-size:15px;line-height:1.85;color:var(--s7)}
        .q-body b,.q-body strong{color:var(--s9);font-weight:700}
        .q-body .sub{margin-top:12px;padding-left:2px}.q-body .sub p{margin-bottom:8px;line-height:1.75}
        .m{font-family:'JetBrains Mono',monospace;font-size:.9em;color:var(--s9);letter-spacing:.3px;background:var(--s0);padding:1px 4px;border-radius:3px}
        .math-box{display:flex;justify-content:center;align-items:center;margin:16px 0;padding:18px 20px;background:var(--s0);border-radius:10px;border:1px solid var(--s2)}
        .math-box .m{font-size:1.1em;background:none;padding:0}
        .frac{display:inline-flex;flex-direction:column;align-items:center;vertical-align:middle;margin:0 3px}
        .frac .top,.frac .bot{padding:2px 5px;text-align:center;line-height:1.4}.frac .top{border-bottom:2px solid var(--s7)}
        .sup{font-size:.72em;vertical-align:super;line-height:0}
        .ans-card{padding:16px 20px}
        .ans-label{font-size:11px;font-weight:600;color:var(--s5);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px}
        .ans-hint{font-size:11px;color:var(--s4);margin-bottom:8px}
        .ans-input{width:100%;border:1.5px solid var(--s2);border-radius:8px;padding:10px 12px;font-family:'JetBrains Mono',monospace;font-size:13px;color:var(--s9);outline:none;transition:border .2s}
        .ans-input:focus{border-color:var(--b5);box-shadow:0 0 0 3px rgba(59,130,246,.08)}
        .ans-input::placeholder{color:var(--s4);font-family:'Noto Sans KR',sans-serif;font-size:12px}

        /* ===== SUBMIT SCREEN ===== */
        .submit-pad{padding:28px 24px}
        .submit-pad h2{font-size:18px;color:var(--s9);margin-bottom:5px}
        .submit-sub{font-size:13px;color:var(--s5);margin-bottom:20px}
        .ap-row{display:flex;align-items:baseline;gap:10px;padding:8px 0;border-bottom:1px solid var(--s1)}
        .ap-row:last-child{border-bottom:none}
        .ap-num{font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:500;color:var(--b6);min-width:28px}
        .ap-ans{font-family:'JetBrains Mono',monospace;font-size:13px;color:var(--s9);flex:1;word-break:break-all}
        .ap-ans.empty{font-family:'Noto Sans KR',sans-serif;color:var(--s4);font-style:italic;font-size:12px}
        .part-sep{padding:12px 16px;background:var(--s0);border-radius:10px;margin:8px 0 4px;display:flex;align-items:center;gap:8px}
        .part-sep .ps-badge{font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:600;padding:3px 8px;border-radius:4px}
        .part-sep .ps-name{font-size:12px;font-weight:600;color:var(--s7)}
        .upload-section{margin-bottom:20px}
        .upload-label{font-size:13px;font-weight:600;color:var(--s9);margin-bottom:4px}
        .upload-desc{font-size:12px;color:var(--s5);margin-bottom:12px;line-height:1.6}
        .upload-area{border:2px dashed var(--s2);border-radius:12px;padding:24px;text-align:center;cursor:pointer;transition:all .2s;position:relative}
        .upload-area:hover{border-color:var(--b5);background:var(--b0)}
        .upload-area input{position:absolute;inset:0;opacity:0;cursor:pointer}
        .upload-icon{font-size:28px;margin-bottom:8px}
        .upload-text{font-size:13px;color:var(--s5)}.upload-text b{color:var(--b6)}
        .file-list{margin-top:12px}
        .file-item{display:flex;align-items:center;gap:8px;padding:8px 12px;background:var(--s0);border-radius:8px;margin-bottom:6px;font-size:12px;color:var(--s7)}
        .file-item .fname{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
        .file-item .fsize{color:var(--s4);font-family:'JetBrains Mono',monospace;font-size:11px}
        .file-remove{background:none;border:none;color:var(--r6);cursor:pointer;font-size:14px;padding:2px 6px}
        .btn-submit{width:100%;padding:15px;font-family:'Noto Sans KR',sans-serif;font-size:15px;font-weight:600;border:none;border-radius:12px;cursor:pointer;transition:all .15s;margin-bottom:8px}
        .btn-submit:active:not(:disabled){transform:scale(.98)}
        .btn-submit.email{background:var(--b6);color:var(--w)}.btn-submit.email:hover{background:var(--b7)}
        .btn-submit.download{background:var(--s9);color:var(--w)}.btn-submit.download:hover{background:var(--s8)}
        .btn-submit.back{background:var(--s1);color:var(--s7);font-size:13px;font-weight:500}.btn-submit.back:hover{background:var(--s2)}
        .btn-submit:disabled{opacity:.5;cursor:not-allowed}
        .sending-text{font-size:12px;color:var(--s4);text-align:center;margin-top:8px;line-height:1.6}

        /* ===== DONE SCREEN ===== */
        .done-pad{padding:36px 24px;text-align:center}
        .done-icon{font-size:52px;margin-bottom:12px}
        .done-pad h2{font-size:20px;color:var(--s9);margin-bottom:6px}
        .done-pad .done-msg{font-size:13px;color:var(--s5);line-height:1.8;margin-bottom:24px}
        .done-card{background:var(--b0);border:1px solid var(--b1);border-radius:12px;padding:20px;margin-bottom:16px;text-align:left}
        .done-card h3{font-size:14px;color:var(--b7);margin-bottom:8px}
        .done-card p{font-size:12px;color:var(--s7);line-height:1.7;margin-bottom:4px}
        .done-timeline{display:flex;gap:4px;align-items:center;margin-top:12px}
        .done-step{flex:1;text-align:center;padding:10px 4px;background:var(--w);border-radius:8px}
        .done-step .ds-icon{font-size:20px;margin-bottom:3px}
        .done-step .ds-text{font-size:10px;color:var(--s6);line-height:1.3}
        .done-arrow{color:var(--s3);font-size:16px;flex-shrink:0}
        .kakao-btn{width:100%;padding:15px;font-family:'Noto Sans KR',sans-serif;font-size:15px;font-weight:600;border:none;border-radius:12px;cursor:pointer;background:#FEE500;color:#3C1E1E;margin-bottom:8px;transition:all .15s}
        .kakao-btn:active{transform:scale(.98)}
        .kakao-btn:hover{background:#fdd835}

        /* ===== REVIEW (teacher) ===== */
        .review-pad{padding:28px 24px}
        .review-pad h2{font-size:17px;color:var(--s9);margin-bottom:3px}
        .rv-sub{font-size:12px;color:var(--s5);margin-bottom:5px}
        .rv-name{font-size:14px;font-weight:600;color:var(--b6);margin-bottom:2px}
        .rv-date{font-size:11px;color:var(--s4);font-family:'JetBrains Mono',monospace;margin-bottom:16px}
        .rv-stats{display:flex;gap:8px;margin-bottom:20px}
        .rv-stat{flex:1;background:var(--s0);border-radius:8px;padding:12px;text-align:center}
        .rv-stat .n{font-size:20px;font-weight:700;color:var(--s9)}.rv-stat .l{font-size:10px;color:var(--s4);text-transform:uppercase;letter-spacing:.5px;margin-top:2px}
        .rv-card{border:1px solid var(--s2);border-radius:10px;margin-bottom:12px;overflow:hidden}
        .rv-head{display:flex;align-items:center;gap:8px;padding:11px 14px;background:var(--s0);border-bottom:1px solid var(--s2)}
        .rv-num{font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:500;color:var(--b6);background:var(--b0);padding:3px 8px;border-radius:5px}
        .rv-cat{font-size:12px;color:var(--s5);font-weight:500}
        .rv-tag{font-size:10px;margin-left:auto;padding:2px 7px;border-radius:4px;font-weight:500}
        .rv-tag.ok{background:var(--e0);color:var(--e6)}.rv-tag.no{background:var(--a0);color:var(--a6)}
        .rv-body{padding:14px;font-family:'JetBrains Mono',monospace;font-size:13px;line-height:1.6;color:var(--s9)}
        .rv-body.empty{font-family:'Noto Sans KR',sans-serif;color:var(--s4);font-style:italic;font-size:12px}
        .rv-images{padding:14px;border-top:1px solid var(--s1)}
        .rv-images h4{font-size:12px;color:var(--s5);margin-bottom:10px}
        .rv-img{max-width:100%;border-radius:8px;margin-bottom:8px;border:1px solid var(--s2)}
        .rv-btns{display:flex;gap:8px;margin-top:20px}
        .rv-btns .btn-submit{flex:1}
        .rv-contact{background:var(--v0);border:1px solid var(--v1);border-radius:10px;padding:14px;margin-bottom:16px}
        .rv-contact h4{font-size:12px;color:var(--v6);margin-bottom:6px}
        .rv-contact p{font-size:12px;color:var(--s7);line-height:1.6}

        /* Toast */
        .toast{position:fixed;top:60px;left:50%;transform:translateX(-50%) translateY(-60px);background:var(--s9);color:var(--w);padding:10px 20px;border-radius:10px;font-size:13px;font-weight:500;opacity:0;transition:all .35s cubic-bezier(.4,0,.2,1);pointer-events:none;z-index:50;box-shadow:0 6px 20px rgba(0,0,0,.2)}
        .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

        @media print{body{background:#fff;overflow:visible}.top-bar,.progress-track,.fixed-nav,.rv-btns,.rv-stats{display:none!important}.scroll-area{overflow:visible}.scroll-inner{padding:10px}.card{box-shadow:none;border:1px solid #ddd}.rv-card{break-inside:avoid}}
        @media(max-width:600px){.hero-stats{grid-template-columns:1fr 1fr 1fr}.rv-stats,.rv-btns{flex-direction:column}.done-timeline{flex-wrap:wrap}}
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
</head>
<body>
<div class="top-bar"><div class="logo">ML <span>MATH</span></div><div class="top-badge">Free Diagnostic Test</div></div>
<div class="progress-track"><div class="progress-fill" id="pf" style="width:0%"></div></div>
<div class="scroll-area" id="scroll">
<div class="scroll-inner">

    <!-- ===== SCREEN: LANDING ===== -->
    <div class="screen active" id="s-landing">
        <div class="card"><div class="hero">
            <div class="hero-badge">ğŸ“ IGCSE & Add Math ì „ë¬¸</div>
            <h1>ìš°ë¦¬ ì•„ì´ ìˆ˜í•™,<br><em>ì •í™•íˆ</em> ì–´ë””ì„œ ë§‰íˆëŠ”ì§€<br>ì•Œê³  ê³„ì‹ ê°€ìš”?</h1>
            <div class="hero-sub">ê³µëŒ€ ì„ì‚¬ ì¶œì‹  ì„ ìƒë‹˜ì´ ì§ì ‘ ì„¤ê³„í•œ ì •ë°€ ì§„ë‹¨ í…ŒìŠ¤íŠ¸ë¡œ<br>ì•„ì´ì˜ í˜„ì¬ ìˆ˜ì¤€ê³¼ ë³´ì™„ì ì„ ë¬´ë£Œë¡œ ë¶„ì„í•´ ë“œë¦½ë‹ˆë‹¤.</div>
            <div class="hero-stats">
                <div class="hero-stat"><div class="n">12~25</div><div class="l">ë¬¸í•­</div></div>
                <div class="hero-stat"><div class="n">30~45</div><div class="l">ë¶„</div></div>
                <div class="hero-stat"><div class="n">5</div><div class="l">ì˜ì—­ ì§„ë‹¨</div></div>
            </div>
            <div class="usp-list">
                <div class="usp"><div class="ic">ğŸ¯</div><div class="tx"><b>"ê³µì‹ì€ ì•„ëŠ”ë° ì‘ìš©ì´ ì•ˆ ë¼ìš”"</b><br>ê°œë… ì´í•´ë„ì™€ ì ìš© ëŠ¥ë ¥ì„ ë™ì‹œì— ì ê²€í•©ë‹ˆë‹¤.</div></div>
                <div class="usp"><div class="ic">ğŸ“</div><div class="tx"><b>"Show that" ì„œìˆ  ëŠ¥ë ¥ í‰ê°€</b><br>í•œêµ­ ìˆ˜í•™ì— ì—†ëŠ” ì˜êµ­ì‹ ì¦ëª… ë¬¸ì œ ëŒ€ì‘ë ¥ì„ ì§„ë‹¨í•©ë‹ˆë‹¤.</div></div>
                <div class="usp"><div class="ic">ğŸ“Š</div><div class="tx"><b>ë§ì¶¤ ë¶„ì„ ë¦¬í¬íŠ¸ ì œê³µ</b><br>í…ŒìŠ¤íŠ¸ í›„ 48ì‹œê°„ ë‚´ì— ìƒì„¸ ë¶„ì„ ê²°ê³¼ë¥¼ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.</div></div>
            </div>
            <button class="btn-big primary" onclick="show('s-register')">ë¬´ë£Œ ë ˆë²¨í…ŒìŠ¤íŠ¸ ì‹œì‘í•˜ê¸° â†’</button>
        </div></div>
    </div>

    <!-- ===== SCREEN: REGISTRATION ===== -->
    <div class="screen" id="s-register">
        <div class="card"><div class="reg-pad">
            <h2>ğŸ“‹ í•™ìƒ ì •ë³´ ì…ë ¥</h2>
            <div class="reg-sub">í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¶„ì„ì„ ìœ„í•´ ì•„ë˜ ì •ë³´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.</div>

            <div class="form-group">
                <div class="form-label">í•™ìƒ ì´ë¦„ <span class="req">*í•„ìˆ˜</span></div>
                <input type="text" class="form-input" id="inp-name" placeholder="í•™ìƒ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="form-group">
                <div class="form-label">í•™êµ</div>
                <input type="text" class="form-input" id="inp-school" placeholder="ì˜ˆ: HELP International School">
            </div>
            <div class="form-group">
                <div class="form-label">í•™ë…„ (Year Group) <span class="req">*í•„ìˆ˜</span></div>
                <select class="form-input" id="inp-year">
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="Year 7">Year 7</option>
                    <option value="Year 8">Year 8</option>
                    <option value="Year 9">Year 9</option>
                    <option value="Year 10">Year 10</option>
                    <option value="Year 11">Year 11</option>
                    <option value="Year 12">Year 12 (AS Level)</option>
                    <option value="Year 13">Year 13 (A Level)</option>
                </select>
            </div>
            <div class="form-group">
                <div class="form-label">ë³´í˜¸ì ì—°ë½ì²˜ (ì¹´ì¹´ì˜¤í†¡ ID ë˜ëŠ” ì „í™”ë²ˆí˜¸) <span class="req">*í•„ìˆ˜</span></div>
                <input type="text" class="form-input" id="inp-contact" placeholder="ì˜ˆ: +60 12-345-6789 ë˜ëŠ” ì¹´ì¹´ì˜¤í†¡ ID">
                <div class="form-hint">ë¶„ì„ ê²°ê³¼ë¥¼ ë³´ë‚´ë“œë¦¬ê¸° ìœ„í•´ í•„ìš”í•©ë‹ˆë‹¤. (ë§ë ˆì´ì‹œì•„ +60 / í•œêµ­ +82)<br>ğŸ“Œ í…ŒìŠ¤íŠ¸ ì œì¶œ í›„ <a href="https://open.kakao.com/o/ssOgKj8h" target="_blank" style="color:var(--b6);text-decoration:underline">ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ…</a>ìœ¼ë¡œ ì—°ë½ì£¼ì‹œë©´ ë” ë¹ ë¥´ê²Œ ê²°ê³¼ë¥¼ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
            </div>
            <div class="form-group">
                <div class="form-label">Additional Mathematics ìˆ˜ê°• ì—¬ë¶€ <span class="req">*í•„ìˆ˜</span></div>
                <div class="addm-toggle" id="addm-toggle">
                    <button type="button" class="addm-btn active" id="addm-no" onclick="setAddMath(false)">IGCSE Mathë§Œ</button>
                    <button type="button" class="addm-btn" id="addm-yes" onclick="setAddMath(true)">IGCSE + Add Math</button>
                </div>
                <div class="addm-info" id="addm-info">
                    <span class="addm-tag igcse">IGCSE Only</span> 12ë¬¸í•­ Â· 30ë¶„ Â· ê¸°ì´ˆ~í•µì‹¬ ì ìš©
                </div>
            </div>
            <div class="form-group">
                <div class="form-label">ë³´í˜¸ì ì´ë©”ì¼ (ì„ íƒ)</div>
                <input type="email" class="form-input" id="inp-email" placeholder="ì˜ˆ: parent@email.com">
            </div>

            <div class="warn-box"><div class="ic">âš ï¸</div><p><strong>ì‹œí—˜ ì•ˆë‚´:</strong> ê³„ì‚°ê¸° ì‚¬ìš© ê¸ˆì§€. ê° ë¬¸ì œì˜ <b>ìµœì¢… ë‹µ</b>ë§Œ ì…ë ¥í•˜ê³ , <b>í’€ì´ ê³¼ì •</b>ì€ ê³µì±…ì´ë‚˜ ì•„ì´íŒ¨ë“œì— ì‘ì„± í›„ ë§ˆì§€ë§‰ì— ì‚¬ì§„ìœ¼ë¡œ ì—…ë¡œë“œí•˜ì„¸ìš”.</p></div>

            <div id="reg-error" class="form-error" style="text-align:center;margin-bottom:12px"></div>
            <button class="btn-big blue" onclick="startTest()">í…ŒìŠ¤íŠ¸ ì‹œì‘ â†’</button>
            <button class="btn-big secondary" onclick="show('s-landing')">â† ëŒì•„ê°€ê¸°</button>
            <div class="privacy-note">ğŸ”’ ì…ë ¥ëœ ì •ë³´ëŠ” ë ˆë²¨í…ŒìŠ¤íŠ¸ ë¶„ì„ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©ë˜ë©°,<br>ì œ3ìì—ê²Œ ì œê³µë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
        </div></div>
        <!-- Teacher-only load button (hidden) -->
        <button class="btn-big secondary" onclick="document.getElementById('f-load').click()" style="margin-top:4px;font-size:11px;color:var(--s4)">ğŸ“‚ ì„ ìƒë‹˜ìš©: ì €ì¥ëœ ë‹µì•ˆ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <input type="file" id="f-load" class="file-hidden" accept=".json" onchange="loadFile(event)">
    </div>

    <!-- ===== SCREEN: QUESTION ===== -->
    <div class="screen" id="s-q">
        <div class="card">
            <div class="part-strip" id="ps"><div class="part-badge" id="pb"></div><div class="part-info"><div class="part-title" id="pt"></div><div class="part-focus" id="pfo"></div></div><div class="part-time" id="ptm"></div></div>
            <div class="q-pad"><div class="q-label"><div class="q-num" id="qn"></div><div class="q-cat" id="qc"></div><div class="q-dot" id="qd"></div></div><div class="q-body" id="qb"></div></div>
        </div>
        <div class="card"><div class="ans-card">
            <div class="ans-label">âœï¸ Answer</div>
            <div class="ans-hint">ë‹µë§Œ ê°„ë‹¨íˆ ì ìœ¼ì„¸ìš”. í’€ì´ ê³¼ì •ì€ ë§ˆì§€ë§‰ì— ì‚¬ì§„ìœ¼ë¡œ ì œì¶œí•©ë‹ˆë‹¤.</div>
            <input type="text" class="ans-input" id="ans" placeholder="ì˜ˆ: x = 3, y = 7">
        </div></div>
    </div>

    <!-- ===== SCREEN: SUBMIT ===== -->
    <div class="screen" id="s-submit"><div class="card"><div class="submit-pad">
        <h2>ğŸ“ ë‹µì•ˆ í™•ì¸ & ì œì¶œ</h2>
        <div class="submit-sub">ë‹µì„ í™•ì¸í•˜ê³  í’€ì´ ê³¼ì • ì‚¬ì§„ì„ ì—…ë¡œë“œí•œ í›„ ì œì¶œí•˜ì„¸ìš”.</div>
        <div id="ans-preview" style="margin-bottom:20px"></div>
        <div class="upload-section">
            <div class="upload-label">ğŸ“¸ í’€ì´ ê³¼ì • ì—…ë¡œë“œ</div>
            <div class="upload-desc">í’€ì´ ê³¼ì •ì„ ì‚¬ì§„ ë˜ëŠ” PDFë¡œ ì—…ë¡œë“œí•˜ì„¸ìš”. ì—¬ëŸ¬ íŒŒì¼ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
            <div class="upload-area"><input type="file" id="file-input" multiple accept="image/*,.pdf" onchange="handleFiles(event)"><div class="upload-icon">ğŸ“</div><div class="upload-text"><b>í„°ì¹˜í•˜ì—¬ íŒŒì¼ ì„ íƒ</b> ë˜ëŠ” ë“œë˜ê·¸ ì•¤ ë“œë¡­</div></div>
            <div class="file-list" id="file-list"></div>
        </div>
        <button class="btn-submit email" id="btn-email" onclick="submitEmail()">ğŸ“§ ì œì¶œí•˜ê¸°</button>
        <button class="btn-submit back" onclick="backToQ()">â† ë¬¸ì œë¡œ ëŒì•„ê°€ê¸°</button>
        <div class="sending-text" id="sending-text"></div>
    </div></div></div>

    <!-- ===== SCREEN: DONE ===== -->
    <div class="screen" id="s-done"><div class="card"><div class="done-pad">
        <div class="done-icon">ğŸ‰</div>
        <h2>ì œì¶œ ì™„ë£Œ! ìˆ˜ê³ í–ˆì–´ìš”!</h2>
        <div class="done-msg">ë‹µì•ˆì´ ì„ ìƒë‹˜ì—ê²Œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.<br>ê¼¼ê¼¼íˆ ë¶„ì„í•´ì„œ ê²°ê³¼ë¥¼ ë³´ë‚´ë“œë¦´ê²Œìš”.</div>

        <div class="done-card" style="background:#FFF9DB;border-color:#FEE500">
            <h3 style="color:#3C1E1E">ğŸ’¬ ê²°ê³¼ë¥¼ ë°›ìœ¼ì‹œë ¤ë©´ ì˜¤í”ˆì±„íŒ…ìœ¼ë¡œ ì—°ë½í•´ ì£¼ì„¸ìš”!</h3>
            <p>ì•„ë˜ ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ… ë²„íŠ¼ì„ ëˆŒëŸ¬ <b>í•™ìƒ ì´ë¦„</b>ê³¼ <b>í•™ë…„</b>ì„ ì±„íŒ…ì°½ì— ë‚¨ê²¨ì£¼ì‹œë©´,<br>48ì‹œê°„ ë‚´ì— ë¶„ì„ ê²°ê³¼ì™€ í•¨ê»˜ ë¬´ë£Œ ìƒë‹´ì„ ì§„í–‰í•´ ë“œë¦½ë‹ˆë‹¤.</p>
            <p style="margin-top:8px;font-size:11px;color:var(--s5)">ì˜ˆì‹œ: "í™ê¸¸ë™ Year 10 ë ˆë²¨í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¶€íƒë“œë¦½ë‹ˆë‹¤"</p>
        </div>

        <button class="kakao-btn" onclick="window.open('https://open.kakao.com/o/ssOgKj8h','_blank')">ğŸ’¬ ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ…ìœ¼ë¡œ ì—°ë½í•˜ê¸°</button>

        <div class="done-card" style="margin-top:12px">
            <h3>ğŸ“Š ì•ìœ¼ë¡œì˜ ì§„í–‰ ê³¼ì •</h3>
            <div class="done-timeline">
                <div class="done-step"><div class="ds-icon">âœ…</div><div class="ds-text">í…ŒìŠ¤íŠ¸<br>ì™„ë£Œ</div></div>
                <div class="done-arrow">â†’</div>
                <div class="done-step"><div class="ds-icon">ğŸ’¬</div><div class="ds-text">ì˜¤í”ˆì±„íŒ…<br>ì—°ë½</div></div>
                <div class="done-arrow">â†’</div>
                <div class="done-step"><div class="ds-icon">ğŸ“‹</div><div class="ds-text">ê²°ê³¼<br>ë¦¬í¬íŠ¸</div></div>
                <div class="done-arrow">â†’</div>
                <div class="done-step"><div class="ds-icon">ğŸ¯</div><div class="ds-text">ë¬´ë£Œ<br>ìƒë‹´</div></div>
            </div>
        </div>

        <button class="btn-big secondary" onclick="reset()">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div></div></div>

    <!-- ===== SCREEN: REVIEW (teacher) ===== -->
    <div class="screen" id="s-review"><div class="card"><div class="review-pad">
        <h2>ğŸ“‹ Answer Review</h2><div class="rv-sub">í•™ìƒ ë‹µì•ˆ í™•ì¸ (ì„ ìƒë‹˜ìš©)</div>
        <div class="rv-name" id="rv-name"></div><div class="rv-date" id="rv-date"></div>
        <div id="rv-contact-box"></div>
        <div class="rv-stats" id="rv-stats"></div>
        <div id="rv-cards"></div>
        <div id="rv-imgs"></div>
        <div class="rv-btns">
            <button class="btn-submit back" onclick="reset()">â† ì²˜ìŒìœ¼ë¡œ</button>
            <button class="btn-submit download" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„</button>
        </div>
    </div></div></div>

</div></div>

<div class="fixed-nav" id="fnav">
    <button class="btn btn-prev" id="bp" onclick="go(-1)" disabled>â† Prev</button>
    <div class="page-indicator" id="pi">1/25</div>
    <button class="btn btn-next" id="bn" onclick="go(1)">Next â†’</button>
</div>
<div class="toast" id="toast"></div>

<script>
// ===== EmailJS Config =====
const EJS_KEY='EMOoQhWuKVAJ74Oiu';
const EJS_SVC='service_1dwyydc';
const EJS_TPL='template_7zwxoym';
const TEACHER='shoybk0115@gmail.com';
emailjs.init(EJS_KEY);

// ===== Question Data =====
const Q=[
{p:'a',pt:'Algebraic Foundations',pf:'Focus: Computational fluency without a calculator.',pm:'15 min',n:'Q1',c:'Surds',
b:`<p>Simplify the following expression to find the exact value:</p><div class="math-box"><span class="m"><span class="frac"><span class="top">âˆš50 âˆ’ âˆš8</span><span class="bot">âˆš2</span></span></span></div>`},
{p:'a',pt:'Algebraic Foundations',pf:'Focus: Computational fluency without a calculator.',pm:'15 min',n:'Q2',c:'Algebraic Fractions',
b:`<p>Simplify the expression fully:</p><div class="math-box"><span class="m"><span class="frac"><span class="top">x<span class="sup">2</span> âˆ’ 9</span><span class="bot">x<span class="sup">2</span> + 5x + 6</span></span></span></div>`},
{p:'a',pt:'Algebraic Foundations',pf:'Focus: Computational fluency without a calculator.',pm:'15 min',n:'Q3',c:'Simultaneous Equations',
b:`<p>Solve the simultaneous equations:</p><div class="math-box"><span class="m">y = 2x + 1</span></div><div class="math-box"><span class="m">x<span class="sup">2</span> + y<span class="sup">2</span> = 10</span></div>`},
{p:'a',pt:'Algebraic Foundations',pf:'Focus: Computational fluency without a calculator.',pm:'15 min',n:'Q4',c:'Indices',
b:`<p>Simplify fully, giving your answer with positive indices:</p><div class="math-box"><span class="m"><span class="frac"><span class="top">(2x<span class="sup">3</span>y<span class="sup">âˆ’2</span>)<span class="sup">3</span></span><span class="bot">(4x<span class="sup">âˆ’1</span>y)<span class="sup">2</span></span></span></span></div>`},
{p:'a',pt:'Algebraic Foundations',pf:'Focus: Computational fluency without a calculator.',pm:'15 min',n:'Q5',c:'Quadratic Inequalities',
b:`<p>Solve the inequality and show your solution on a number line:</p><div class="math-box"><span class="m">x<span class="sup">2</span> âˆ’ 5x + 6 < 0</span></div>`},
{p:'b',pt:'IGCSE Core Application',pf:'Focus: Logical reasoning and proof-style questions.',pm:'25 min',n:'Q6',c:'Coordinate Geometry',
b:`<p>The equation of line <span class="m">Lâ‚</span> is <span class="m">2y + 3x = 12</span>.</p><div class="sub"><p><strong>(a)</strong> Find the gradient of <span class="m">Lâ‚</span>.</p><p><strong>(b)</strong> Line <span class="m">Lâ‚‚</span> is perpendicular to <span class="m">Lâ‚</span> and passes through the point <span class="m">(6, 1)</span>. Find the equation of <span class="m">Lâ‚‚</span>.</p><p><strong>(c)</strong> Find the coordinates of the point where <span class="m">Lâ‚</span> and <span class="m">Lâ‚‚</span> intersect.</p></div>`},
{p:'b',pt:'IGCSE Core Application',pf:'Focus: Logical reasoning and proof-style questions.',pm:'25 min',n:'Q7',c:'Mathematical Modeling',
b:`<p>A triangle has sides of length <span class="m">(x + 1)</span> cm, <span class="m">(2x âˆ’ 3)</span> cm and <span class="m">x</span> cm. The perimeter of the triangle is 26 cm.</p><div class="sub"><p><strong>(a)</strong> Find the value of <span class="m">x</span>.</p><p><strong>(b)</strong> <strong>Show that</strong> the triangle is right-angled.</p></div>`},
{p:'b',pt:'IGCSE Core Application',pf:'Focus: Logical reasoning and proof-style questions.',pm:'25 min',n:'Q8',c:'Circle Theorems',
b:`<p>A, B, C and D are points on a circle with centre O. Angle <span class="m">ABC = 112Â°</span>.</p><div class="sub"><p><strong>(a)</strong> Find angle <span class="m">ADC</span>. Give a reason for your answer.</p><p><strong>(b)</strong> Find angle <span class="m">AOC</span>. Give a reason for your answer.</p></div>`},
{p:'b',pt:'IGCSE Core Application',pf:'Focus: Logical reasoning and proof-style questions.',pm:'25 min',n:'Q9',c:'Sequences (Geometric)',
b:`<p>The first three terms of a geometric sequence are <span class="m">2, 6, 18, ...</span></p><div class="sub"><p><strong>(a)</strong> Find the common ratio.</p><p><strong>(b)</strong> Find the 8th term.</p><p><strong>(c)</strong> Find the sum of the first 10 terms.</p></div>`},
{p:'b',pt:'IGCSE Core Application',pf:'Focus: Logical reasoning and proof-style questions.',pm:'25 min',n:'Q10',c:'Probability',
b:`<p>A bag contains 4 red balls and 6 blue balls. Two balls are drawn at random <strong>without replacement</strong>.</p><div class="sub"><p><strong>(a)</strong> Draw a tree diagram to show all possible outcomes.</p><p><strong>(b)</strong> Find the probability that both balls are the same colour.</p></div>`},
{p:'b',pt:'IGCSE Core Application',pf:'Focus: Logical reasoning and proof-style questions.',pm:'25 min',n:'Q11',c:'Vectors',
b:`<p>In triangle OAB, M is the midpoint of AB.</p><p><span class="m">OA = <b>a</b></span> and <span class="m">OB = <b>b</b></span>.</p><div class="sub"><p><strong>(a)</strong> Express <span class="m">AB</span> in terms of <span class="m"><b>a</b></span> and <span class="m"><b>b</b></span>.</p><p><strong>(b)</strong> Express <span class="m">OM</span> in terms of <span class="m"><b>a</b></span> and <span class="m"><b>b</b></span>.</p><p><strong>(c)</strong> Point P lies on OM such that <span class="m">OP = (2/3)OM</span>. Express <span class="m">AP</span> in terms of <span class="m"><b>a</b></span> and <span class="m"><b>b</b></span>.</p></div>`},
{p:'b',pt:'IGCSE Core Application',pf:'Focus: Logical reasoning and proof-style questions.',pm:'25 min',n:'Q12',c:'Sets & Venn Diagrams',
b:`<p>In a class of 40 students, 25 study Biology, 22 study Chemistry, and 8 study neither subject.</p><div class="sub"><p><strong>(a)</strong> Find the number of students who study both subjects.</p><p><strong>(b)</strong> Find the probability that a randomly chosen student studies Biology but not Chemistry.</p></div>`},
{p:'c',pt:'Add Math: Functions & Algebra',pf:'Focus: Connecting multiple concepts.',pm:'20 min',n:'Q13',c:'Numerical Methods',
b:`<p>Given <span class="m">y = xÂ³ âˆ’ 3x + 1</span>,</p><p style="margin-top:12px">explain why there must be a root between <span class="m">x = âˆ’2</span> and <span class="m">x = âˆ’1</span>.</p>`},
{p:'c',pt:'Add Math: Functions & Algebra',pf:'Focus: Connecting multiple concepts.',pm:'20 min',n:'Q14',c:'Composite & Inverse Functions',
b:`<p>Let <span class="m">f(x) = 3x âˆ’ 5</span> and <span class="m">g(x) = xÂ² + 2</span>.</p><div class="sub"><p><strong>(a)</strong> Find <span class="m">gf(x)</span>. Simplify your answer.</p><p><strong>(b)</strong> Solve the equation <span class="m">gf(x) = g(x)</span>.</p><p><strong>(c)</strong> Find <span class="m">f<span class="sup">âˆ’1</span>(x)</span>.</p></div>`},
{p:'c',pt:'Add Math: Functions & Algebra',pf:'Focus: Connecting multiple concepts.',pm:'20 min',n:'Q15',c:'The Discriminant',
b:`<p>The equation</p><div class="math-box"><span class="m">(k + 1)x<span class="sup">2</span> + (4k)x + 9 = 0</span></div><p>has <strong>exactly one</strong> real root.</p><div class="sub"><p><strong>(a)</strong> Find the possible values of <span class="m">k</span>.</p><p><strong>(b)</strong> For each value of <span class="m">k</span>, find the corresponding root of the equation.</p></div>`},
{p:'c',pt:'Add Math: Functions & Algebra',pf:'Focus: Connecting multiple concepts.',pm:'20 min',n:'Q16',c:'Logarithms & Exponentials',
b:`<p>Solve the following equations:</p><div class="sub"><p><strong>(a)</strong> <span class="m">logâ‚‚(x) + logâ‚‚(x âˆ’ 6) = 4</span></p><p><strong>(b)</strong> <span class="m">3<span class="sup">x+1</span> = 5<span class="sup">xâˆ’2</span></span></p><p style="margin-top:4px;font-size:13px;color:var(--s5)">(Give your answer in the form <span class="m">x = ln a / ln b</span>)</p></div>`},
{p:'c',pt:'Add Math: Functions & Algebra',pf:'Focus: Connecting multiple concepts.',pm:'20 min',n:'Q17',c:'Binomial Expansion',
b:`<p>In the expansion of <span class="m">(2 + kx)<span class="sup">6</span></span> :</p><div class="sub"><p><strong>(a)</strong> Find the first 3 terms in ascending powers of <span class="m">x</span>.</p><p><strong>(b)</strong> Given that the coefficient of <span class="m">x<span class="sup">2</span></span> is 60, find the value of <span class="m">k</span>.</p></div>`},
{p:'c',pt:'Add Math: Functions & Algebra',pf:'Focus: Connecting multiple concepts.',pm:'20 min',n:'Q18',c:'Factor & Remainder Theorem',
b:`<p><span class="m">f(x) = 2xÂ³ + axÂ² âˆ’ 5x + b</span></p><p style="margin-top:8px">Given that <span class="m">(x âˆ’ 1)</span> is a factor of <span class="m">f(x)</span> and <span class="m">f(âˆ’2) = 15</span> :</p><div class="sub"><p><strong>(a)</strong> Find the values of <span class="m">a</span> and <span class="m">b</span>.</p><p><strong>(b)</strong> Factorise <span class="m">f(x)</span> completely.</p></div>`},
{p:'d',pt:'Calculus & Trigonometry',pf:'Focus: Differentiation, integration, trig.',pm:'15 min',n:'Q19',c:'Differentiation & Curve Properties',
b:`<p>A curve has the equation <span class="m">y = 2xÂ² âˆ’ 8x + 6</span>.</p><div class="sub"><p><strong>(a)</strong> Express <span class="m">2xÂ² âˆ’ 8x + 6</span> in the form <span class="m">a(x âˆ’ p)Â² + q</span>.</p><p><strong>(b)</strong> State the coordinates of the turning point of the curve.</p><p><strong>(c)</strong> Find <span class="m"><span class="frac"><span class="top">dy</span><span class="bot">dx</span></span></span> and verify that the gradient at the turning point is zero.</p><p><strong>(d)</strong> The line <span class="m">y = kx</span> is a tangent to the curve. Find the value of <span class="m">k</span>.</p></div>`},
{p:'d',pt:'Calculus & Trigonometry',pf:'Focus: Differentiation, integration, trig.',pm:'15 min',n:'Q20',c:'Trigonometric Equations',
b:`<p>Solve the equation for <span class="m">0Â° â‰¤ Î¸ â‰¤ 360Â°</span> without using a calculator:</p><div class="math-box"><span class="m">2cosÂ²Î¸ + sinÎ¸ âˆ’ 1 = 0</span></div>`},
{p:'d',pt:'Calculus & Trigonometry',pf:'Focus: Differentiation, integration, trig.',pm:'15 min',n:'Q21',c:'Integration',
b:`<p>A curve has the equation <span class="m">y = xÂ² âˆ’ 4x + 3</span>.</p><div class="sub"><p><strong>(a)</strong> Find the x-intercepts of the curve.</p><p><strong>(b)</strong> Calculate the area enclosed between the curve and the x-axis.</p></div>`},
{p:'d',pt:'Calculus & Trigonometry',pf:'Focus: Differentiation, integration, trig.',pm:'15 min',n:'Q22',c:'Circular Measure (Radians)',
b:`<p>A sector of a circle has radius <span class="m">8 cm</span> and angle <span class="m">1.5 radians</span>.</p><div class="sub"><p><strong>(a)</strong> Find the arc length of the sector.</p><p><strong>(b)</strong> Find the area of the sector.</p><p><strong>(c)</strong> Find the area of the segment (region between the chord and the arc).</p></div>`},
{p:'d',pt:'Calculus & Trigonometry',pf:'Focus: Differentiation, integration, trig.',pm:'15 min',n:'Q23',c:'Kinematics',
b:`<p>A particle moves in a straight line. Its velocity <span class="m">v</span> m/s at time <span class="m">t</span> seconds is given by</p><div class="math-box"><span class="m">v = 3t<span class="sup">2</span> âˆ’ 12t + 9</span></div><p>for <span class="m">t â‰¥ 0</span>.</p><div class="sub"><p><strong>(a)</strong> Find the values of <span class="m">t</span> when the particle is at rest.</p><p><strong>(b)</strong> Find the acceleration when <span class="m">t = 2</span>.</p><p><strong>(c)</strong> Find the total distance travelled in the first 3 seconds.</p></div>`},
{p:'e',pt:'Challenge Problems',pf:'Focus: Multi-step reasoning.',pm:'5 min',n:'Q24',c:'Permutations & Combinations',
b:`<p>A committee of 5 people is to be chosen from 6 men and 4 women.</p><div class="sub"><p><strong>(a)</strong> Find the total number of ways to form the committee.</p><p><strong>(b)</strong> Find the number of ways if the committee must contain <strong>at least 2 women</strong>.</p></div>`},
{p:'e',pt:'Challenge Problems',pf:'Focus: Multi-step reasoning.',pm:'5 min',n:'Q25',c:'Optimization (Calculus + Modeling)',
b:`<p>A farmer has <span class="m">60 m</span> of fencing to enclose a rectangular pen against an existing wall. The wall forms one side of the rectangle. Let <span class="m">x</span> be the length of the sides perpendicular to the wall.</p><div class="sub"><p><strong>(a)</strong> <strong>Show that</strong> the area <span class="m">A</span> of the pen is given by <span class="m">A = 60x âˆ’ 2xÂ²</span>.</p><p><strong>(b)</strong> Find <span class="m"><span class="frac"><span class="top">dA</span><span class="bot">dx</span></span></span> and hence find the value of <span class="m">x</span> that maximises the area.</p><p><strong>(c)</strong> Find the maximum area of the pen.</p><p><strong>(d)</strong> Verify that this is a maximum using the second derivative test.</p></div>`}
];

const PC={a:'part-a',b:'part-b',c:'part-c',d:'part-d',e:'part-e'};
const PL={a:'Part A',b:'Part B',c:'Part C',d:'Part D',e:'Part E'};
let idx=0,A=Array(Q.length).fill(''),sN='',sY='',sSch='',sCon='',sEm='',UF=[];
let isAddMath=false;
let AQ=[]; // Active questions (filtered)
let AMap=[]; // Maps AQ index â†’ Q index (for answers)

// ===== Add Math Toggle =====
function setAddMath(v){
    isAddMath=v;
    document.getElementById('addm-yes').classList.toggle('active',v);
    document.getElementById('addm-no').classList.toggle('active',!v);
    const info=document.getElementById('addm-info');
    if(v){
        info.innerHTML='<span class="addm-tag full">IGCSE + Add Math</span> 25ë¬¸í•­ Â· 45ë¶„ Â· ì „ ì˜ì—­ ì¢…í•© ì§„ë‹¨';
    }else{
        info.innerHTML='<span class="addm-tag igcse">IGCSE Only</span> 12ë¬¸í•­ Â· 30ë¶„ Â· ê¸°ì´ˆ~í•µì‹¬ ì ìš©';
    }
}

function buildActiveQuestions(){
    AQ=[];AMap=[];
    Q.forEach((q,i)=>{
        if(isAddMath || q.p==='a' || q.p==='b'){
            AMap.push(i);
            AQ.push(q);
        }
    });
}

// ===== UI Helpers =====
function show(id){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active');document.getElementById('scroll').scrollTop=0;
    // GA: track screen views
    const names={'s-landing':'landing','s-register':'register','s-q':'question','s-submit':'submit','s-done':'done','s-review':'review'};
    if(typeof gtag==='function')gtag('event','page_view',{page_title:names[id]||id,page_path:'/mlmath/'+( names[id]||id)});
}
function prog(v){document.getElementById('pf').style.width=v+'%'}
function fnv(v){document.getElementById('fnav').classList.toggle('show',v)}
function toast(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2500)}

// ===== Start Test =====
function startTest(){
    const name=document.getElementById('inp-name').value.trim();
    const year=document.getElementById('inp-year').value;
    const contact=document.getElementById('inp-contact').value.trim();
    const errEl=document.getElementById('reg-error');

    if(!name||!year||!contact){
        errEl.textContent='âš  í•™ìƒ ì´ë¦„, í•™ë…„, ë³´í˜¸ì ì—°ë½ì²˜ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.';
        errEl.style.display='block';
        return;
    }
    errEl.style.display='none';

    sN=name;
    sY=year;
    sSch=document.getElementById('inp-school').value.trim()||'';
    sCon=contact;
    sEm=document.getElementById('inp-email').value.trim()||'';

    buildActiveQuestions();
    A=Array(Q.length).fill('');
    // Update top badge
    document.querySelector('.top-badge').textContent=isAddMath?'Full Â· 25Q Â· 45min':'IGCSE Â· 12Q Â· 30min';

    idx=0;render();show('s-q');fnv(true);
}

// ===== Question Navigation =====
function sv(){A[AMap[idx]]=document.getElementById('ans').value}
function render(){
    const q=AQ[idx];
    document.getElementById('ps').className='part-strip '+PC[q.p];
    document.getElementById('pb').textContent=PL[q.p];
    document.getElementById('pt').textContent=q.pt;
    document.getElementById('pfo').textContent=q.pf;
    document.getElementById('ptm').textContent=q.pm;
    document.getElementById('qn').textContent=q.n;
    document.getElementById('qc').textContent=q.c;
    document.getElementById('qb').innerHTML=q.b;
    document.getElementById('ans').value=A[AMap[idx]]||'';
    document.getElementById('pi').textContent=(idx+1)+'/'+AQ.length;
    document.getElementById('bp').disabled=idx===0;
    document.getElementById('bn').textContent=idx===AQ.length-1?'ì œì¶œ â†’':'Next â†’';
    document.getElementById('qd').classList.toggle('on',!!A[AMap[idx]]);
    prog((idx+1)/AQ.length*100);
    document.getElementById('scroll').scrollTop=0;
}
function go(step){sv();idx+=step;if(idx>=AQ.length){showSubmit();return}if(idx<0)idx=0;render()}
function backToQ(){idx=AQ.length-1;render();show('s-q');fnv(true)}

// ===== Submit Screen =====
function showSubmit(){
    fnv(false);show('s-submit');prog(100);
    const box=document.getElementById('ans-preview');box.innerHTML='';
    let curPart='';
    const colors={a:'var(--b1);color:var(--b7)',b:'var(--a1);color:var(--a6)',c:'var(--v1);color:var(--v6)',d:'var(--e1);color:var(--e6)',e:'var(--r1);color:var(--r6)'};
    AQ.forEach((q,j)=>{
        if(q.p!==curPart){curPart=q.p;
            box.innerHTML+=`<div class="part-sep"><span class="ps-badge" style="background:${colors[q.p]}">${PL[q.p]}</span><span class="ps-name">${q.pt}</span></div>`;
        }
        const a=A[AMap[j]]||'';
        box.innerHTML+=`<div class="ap-row"><div class="ap-num">${q.n}</div><div class="ap-ans${a?'':' empty'}">${a?a.replace(/</g,'&lt;'):'ë¯¸ì‘ì„±'}</div></div>`;
    });
}

// ===== File Upload =====
function handleFiles(e){
    Array.from(e.target.files).forEach(f=>{
        if(f.size>10*1024*1024){toast('âš  10MB ì´í•˜ë§Œ ê°€ëŠ¥');return}
        const r=new FileReader();
        r.onload=ev=>{UF.push({name:f.name,size:f.size,type:f.type,data:ev.target.result});renderFL()};
        r.readAsDataURL(f);
    });e.target.value='';
}
function renderFL(){
    const box=document.getElementById('file-list');box.innerHTML='';
    UF.forEach((f,j)=>{box.innerHTML+=`<div class="file-item"><span>ğŸ“„</span><span class="fname">${f.name}</span><span class="fsize">${Math.round(f.size/1024)}KB</span><button class="file-remove" onclick="UF.splice(${j},1);renderFL()">âœ•</button></div>`});
}

// ===== Email Submit =====
async function submitEmail(){
    const btn=document.getElementById('btn-email'),st=document.getElementById('sending-text');
    btn.disabled=true;btn.textContent='ì „ì†¡ ì¤‘...';st.textContent='ë‹µì•ˆì„ ì „ì†¡í•˜ê³  ìˆìŠµë‹ˆë‹¤...';

    const done=AQ.reduce((c,q,j)=>(A[AMap[j]]&&A[AMap[j]].trim())?c+1:c,0);
    const mode=isAddMath?'IGCSE+AddMath (25Q)':'IGCSE Only (12Q)';
    let txt=`[ML MATH ë ˆë²¨í…ŒìŠ¤íŠ¸]\n`;
    txt+=`í•™ìƒ: ${sN}\ní•™êµ: ${sSch||'-'}\ní•™ë…„: ${sY}\n`;
    txt+=`ë³´í˜¸ì ì—°ë½ì²˜: ${sCon}\në³´í˜¸ì ì´ë©”ì¼: ${sEm||'-'}\n`;
    txt+=`í…ŒìŠ¤íŠ¸: ${mode}\nì‘ì„±: ${done}/${AQ.length}\n\n`;
    AQ.forEach((q,j)=>{txt+=`${q.n}: ${A[AMap[j]]||'-'}\n`});
    txt+=`\ní’€ì´ ì´ë¯¸ì§€: ${UF.length}ê°œ`;

    const timeout=ms=>new Promise((_,rej)=>setTimeout(()=>rej(new Error('timeout')),ms));
    try{
        await Promise.race([
            emailjs.send(EJS_SVC,EJS_TPL,{to_email:TEACHER,student_name:sN,year_group:sY,submit_time:new Date().toLocaleString('ko-KR'),answers_text:txt}),
            timeout(10000)
        ]);
        downloadJSON(true);
        show('s-done');prog(100);fnv(false);
    }catch(err){
        console.error('Email error:',err);
        downloadJSON(true);
        st.innerHTML='âš  ì „ì†¡ì´ ì§€ì—°ë˜ê³  ìˆìŠµë‹ˆë‹¤. <b>ë‹µì•ˆ íŒŒì¼ì´ ìë™ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.</b><br>ì €ì¥ëœ íŒŒì¼ì„ ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ì„ ìƒë‹˜ì—ê²Œ ë³´ë‚´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.';
        btn.disabled=false;btn.textContent='ğŸ“§ ë‹¤ì‹œ ì‹œë„';
    }
}

// ===== Download JSON =====
function downloadJSON(silent){
    const d={studentName:sN,school:sSch,yearGroup:sY,parentContact:sCon,parentEmail:sEm,testMode:isAddMath?'IGCSE+AddMath':'IGCSE Only',totalQuestions:AQ.length,date:new Date().toLocaleString('ko-KR'),answers:AQ.map((q,j)=>({num:q.n,cat:q.c,part:PL[q.p],answer:A[AMap[j]]||''})),images:UF.map(f=>({name:f.name,type:f.type,data:f.data}))};
    const blob=new Blob([JSON.stringify(d,null,2)],{type:'application/json'});
    const u=URL.createObjectURL(blob),a=document.createElement('a');a.href=u;
    a.download=`ML_MATH_${sN.replace(/[^a-zA-Z0-9ê°€-í£]/g,'_')}_${new Date().toISOString().slice(0,10)}.json`;
    a.click();URL.revokeObjectURL(u);
    if(!silent)toast('âœ“ ì €ì¥ ì™„ë£Œ!');
}

// ===== Teacher: Load JSON =====
function loadFile(e){
    const f=e.target.files[0];if(!f)return;
    const r=new FileReader();
    r.onload=function(ev){
        try{const d=JSON.parse(ev.target.result);
        sN=d.studentName||'';sY=d.yearGroup||'';sSch=d.school||'';sCon=d.parentContact||'';sEm=d.parentEmail||'';
        isAddMath=(d.testMode||'').includes('Add');
        buildActiveQuestions();
        A=Array(Q.length).fill('');
        if(d.answers)d.answers.forEach((ans)=>{
            const qi=Q.findIndex(q=>q.n===ans.num);
            if(qi>=0)A[qi]=ans.answer||'';
        });
        openReview(d.images||[]);toast('âœ“ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!')}catch(err){toast('âš  íŒŒì¼ ì˜¤ë¥˜')}
    };r.readAsText(f);e.target.value='';
}

// ===== Teacher: Review =====
function openReview(imgs){
    const mode=isAddMath?'IGCSE + Add Math (25Q)':'IGCSE Only (12Q)';
    document.getElementById('rv-name').textContent='ğŸ‘¤ '+sN+(sY?' ('+sY+')':'');
    document.getElementById('rv-date').textContent=mode+' Â· '+new Date().toLocaleString('ko-KR');

    const cb=document.getElementById('rv-contact-box');
    if(sCon||sEm||sSch){
        cb.innerHTML=`<div class="rv-contact"><h4>ğŸ“± ì—°ë½ì²˜ ì •ë³´</h4>`
            +(sSch?`<p><b>í•™êµ:</b> ${sSch}</p>`:'')
            +(sCon?`<p><b>ë³´í˜¸ì ì—°ë½ì²˜:</b> ${sCon}</p>`:'')
            +(sEm?`<p><b>ë³´í˜¸ì ì´ë©”ì¼:</b> ${sEm}</p>`:'')
            +`</div>`;
    }

    const done=AQ.reduce((c,q,j)=>(A[AMap[j]]&&A[AMap[j]].trim())?c+1:c,0);
    document.getElementById('rv-stats').innerHTML=`<div class="rv-stat"><div class="n">${done}</div><div class="l">ì‘ì„±</div></div><div class="rv-stat"><div class="n">${AQ.length-done}</div><div class="l">ë¯¸ì‘ì„±</div></div><div class="rv-stat"><div class="n">${imgs.length}</div><div class="l">í’€ì´ ì´ë¯¸ì§€</div></div>`;

    const box=document.getElementById('rv-cards');box.innerHTML='';
    let curPart='';
    const colors={a:'var(--b1);color:var(--b7)',b:'var(--a1);color:var(--a6)',c:'var(--v1);color:var(--v6)',d:'var(--e1);color:var(--e6)',e:'var(--r1);color:var(--r6)'};
    AQ.forEach((q,j)=>{
        if(q.p!==curPart){curPart=q.p;
            box.innerHTML+=`<div class="part-sep"><span class="ps-badge" style="background:${colors[q.p]}">${PL[q.p]}</span><span class="ps-name">${q.pt}</span></div>`;
        }
        const a=A[AMap[j]]||'';
        box.innerHTML+=`<div class="rv-card"><div class="rv-head"><div class="rv-num">${q.n}</div><div class="rv-cat">${q.c}</div><div class="rv-tag ${a?'ok':'no'}">${a?'âœ“':'â€”'}</div></div><div class="rv-body${a?'':' empty'}">${a?a.replace(/</g,'&lt;'):'ë¯¸ì‘ì„±'}</div></div>`;
    });

    const ib=document.getElementById('rv-imgs');ib.innerHTML='';
    if(imgs.length>0){
        let h='<div class="card" style="margin-top:16px"><div class="rv-images"><h4>ğŸ“¸ í’€ì´ ê³¼ì • ('+imgs.length+'ê°œ)</h4>';
        imgs.forEach(img=>{h+=img.type&&img.type.startsWith('image/')?`<img class="rv-img" src="${img.data}" alt="${img.name}">`:`<div class="file-item"><span>ğŸ“„</span><span class="fname">${img.name}</span><span class="fsize">PDF</span></div>`});
        h+='</div></div>';ib.innerHTML=h;
    }
    show('s-review');fnv(false);prog(100);
}

// ===== Reset =====
function reset(){idx=0;A=Array(Q.length).fill('');sN='';sY='';sSch='';sCon='';sEm='';UF=[];isAddMath=false;AQ=[];AMap=[];
    document.getElementById('inp-name').value='';document.getElementById('inp-year').value='';
    document.getElementById('inp-school').value='';document.getElementById('inp-contact').value='';
    document.getElementById('inp-email').value='';setAddMath(false);
    document.querySelector('.top-badge').textContent='Free Diagnostic Test';
    prog(0);fnv(false);show('s-landing')}
</script>
</body>
</html>
